
# ????????? Outlook (Outlook) ???? XML ?????????????

???????? XML ????????????????????????????????? Microsoft Outlook **[AppointmentItem](204a409d-654e-27aa-643a-8344c631b82d.md)** ?????????????????????????????????????


|||
|:-----|:-----|
|
![](images/MVPLogo_Small_ZA10349011.jpg)

|Helmut Obertanner ???????? ??????????????Helmut ??Microsoft Visual Studio ? Microsoft Office Outlook ?? Microsoft Office ??????????????[????? Professional Microsoft](https://mvp.microsoft.com/en-us/default.aspx
)???|



?????? ??? ????? C# ??? Visual Basic ????????????????? ?????? ??? (COM) ?????????? .NET Framework ???? ??? ???????????????? ??????????????????? ??? ??? ?????? COM ????????????????????????????????????Outlook ????Visual Studio ??? Outlook ???????????????? (PIA) ????????Outlook 2013 ?????? ??? ????????????Outlook 2013 PIA ????????????Visual Studio ? Microsoft Outlook 15.0 ?????? ????? ??????????????????????????????Outlook ?????  `ThisAddIn` ????????? ?????????? (Visual Studio ? Office Developer Tools ???)????? **Application** ??????? `ThisAddIn.Globals` ??????????? Outlook **Application** ?????????????????Outlook PIA ????????? Outlook ???????????????????MSDN ?? **Outlook ???????????????? ???????????**???????????
????? ???????Outlook ???? ??????????????????? `Sample`???? `CreateAppointmentsFromXml`???????????????????????  **Microsoft.Office.Interop.Outlook**?????????Outlook PIA ???????????
 `CreateAppointmentsFromXml` ??????application ? xml ? 2 ??????????????????

- application ??????? Outlook  **[Application](797003e7-ecd1-eccb-eaaf-32d6ddde8348.md)** ?????????
    
- xml ??XML ?????????? XML ??????????????????????? ????????? XML ?????????????????????
    

|**?????**|**???? XML ??**|
|:-----|:-----|
|???????????|<appointments>|
|????????|<appointment>|
|???????|<starttime>|
|???????|<endtime>|
|???????|<subject>|
|?????|<location>|
|?????|<body>|

????xml ??????????????????



```XML
<?xml version="1.0" encoding="utf-8" ?>  
<appointments> 
    <appointment> 
        <starttime>2009-06-01T15:00:00</starttime> 
        <endtime>2009-06-01T16:15:00</endtime> 
        <subject>This is a Test-Appointment</subject> 
        <location>At your Desk</location> 
        <body>Here is the Bodytext</body> 
    </appointment> 
    <appointment> 
        <starttime>2009-06-01T17:00:00</starttime> 
        <endtime>2009-06-01T17:15:00</endtime> 
        <subject>This is a second Test-Appointment</subject> 
        <location>At your Desk</location> 
        <body>Here is the Bodytext</body> 
    </appointment> 
    <appointment> 
        <starttime>2009-06-01T17:00:00</starttime> 
        <endtime>2009-06-01T18:15:00</endtime> 
        <subject>This is a third Test-Appointment</subject> 
        <location>At your Desk</location> 
        <body>Here is the Bodytext</body> 
    </appointment> 
</appointments> 

```

 `CreateAppointmentsFromXml`??????Microsoft COM ?????????????XML ???????? XML ?????? ?????? ??? (DOM) ? _xml_ ??????? `CreateAppointmentsFromXml`???  _xml_ ???? XML ??? ?????????????????????????????XML ??????? **DOMDocument** ???????????????????? `CreateAppointmentsFromXml`????????????XML DOM ????????? [DOM](http://msdn.microsoft.com/library/e9da2722-7879-4e48-869c-7f16714e2824%28Office.15%29.aspx)??????????
XML ???? <appointment> ???????????????????? `CreateAppointmentsFromXml` ??????????DOM ?????????????????? **AppointmentItem** ???????????????? ( **[Start](1b869a9d-fe08-6efb-48b1-f33cf9ea0024.md)** ? **[End](ce40f8ef-224e-2a64-fe78-cf4ae42be822.md)** ? **[Subject](57f0f242-6d04-175f-4ea2-25145787f5bd.md)** ? **[Location](bde4d455-15de-bb29-c27e-99c34836bd46.md)** ???? **[Body](0b9cec33-d3bf-1902-cc60-36966c06b757.md)** ) ??????????? `CreateAppointmentsFromXml` ?????????????????
 `CreateAppointmentsFromXml`?????? **AppointmentItem** ??????????? **????** ????? **?? ( _?_ ?)** ???? **[Add](http://msdn.microsoft.com/library/frlrfSystemCollectionsGenericList1ClassAddTopic%28Office.15%29.aspx)** ???????????????? XML ?????????????????? **AppointmentItem** ???????????????
????C# ???? ???????



```C#
using System; 
using System.Collections.Generic; 
using System.IO; 
using System.Text; 
using System.Xml; 
using Outlook = Microsoft.Office.Interop.Outlook; 
 
namespace OutlookAddIn1 
{ 
    class Sample 
    { 
        Outlook.AppointmentItem[] CreateAppointmentsFromXml(Outlook.Application application,  
                                                            string xml) 
        { 
            // Create a list of appointment objects. 
            List<Outlook.AppointmentItem> appointments = new  
                List<Microsoft.Office.Interop.Outlook.AppointmentItem>(); 
            XmlDocument xmlDoc = new XmlDocument(); 
 
            // If xml is an XML string, create the document directly.  
            if (xml.StartsWith("<?xml")) 
            { 
                xmlDoc.LoadXml(xml); 
            } 
            else if (File.Exists(xml)) 
            { 
                xmlDoc.Load(xml); 
            } 
            else 
            { 
                throw new Exception( 
                    "The input string is not valid XML data or the specified file doesn't exist."); 
            } 
 
            // Select all appointment nodes under the root appointements node. 
            XmlNodeList appointmentNodes = xmlDoc.SelectNodes("appointments/appointment"); 
            foreach (XmlNode appointmentNode in appointmentNodes) 
            { 
 
                // Create a new AppointmentItem object. 
                Outlook.AppointmentItem newAppointment =  
                    (Outlook.AppointmentItem)application.CreateItem(Outlook.OlItemType.olAppointmentItem); 
 
                // Loop over all child nodes, check the node name, and import the data into the  
                // appointment fields. 
                foreach (XmlNode node in appointmentNode.ChildNodes) 
                { 
                    switch (node.Name) 
                    { 
 
                        case "starttime": 
                            newAppointment.Start = DateTime.Parse(node.InnerText); 
                            break; 
 
                        case "endtime": 
                            newAppointment.End = DateTime.Parse(node.InnerText); 
                            break; 
 
                        case "subject": 
                            newAppointment.Subject = node.InnerText; 
                            break; 
 
                        case "location": 
                            newAppointment.Location = node.InnerText; 
                            break; 
 
                        case "body": 
                            newAppointment.Body = node.InnerText; 
                            break; 
 
                    } 
                } 
 
                // Save the item in the default calendar. 
                newAppointment.Save(); 
                appointments.Add(newAppointment); 
            } 
 
            // Return an array of new appointments. 
            return appointments.ToArray(); 
        } 
 
    } 
}
```

????Visual Basic ???? ???????



```VB.net
Imports System.IO 
Imports System.Xml 
Imports Outlook = Microsoft.Office.Interop.Outlook 
 
Namespace OutlookAddIn2 
    Class Sample 
        Function CreateAppointmentsFromXml(ByVal application As Outlook.Application, _ 
            ByVal xml As String) As Outlook.AppointmentItem() 
 
            Dim appointments As New List(Of Outlook.AppointmentItem) 
            Dim xmlDoc As New XmlDocument() 
 
            If xml is an XML string, create the XML document directly. 
            If xml.StartsWith("<?xml") Then 
                xmlDoc.LoadXml(xml) 
            ElseIf (File.Exists(xml)) Then 
                xmlDoc.Load(xml) 
            Else 
                Throw New Exception("The input string is not valid XML data or the specified file doesn't exist.") 
            End If 
 
 
            ' Select all appointment nodes under the root appointements node. 
            Dim appointmentNodes As XmlNodeList = xmlDoc.SelectNodes("appointments/appointment") 
 
            For Each appointmentNode As XmlNode In appointmentNodes 
 
                ' Create a new AppointmentItem object. 
                Dim newAppointment As Outlook.AppointmentItem = _ 
                    DirectCast(application.CreateItem(Outlook.OlItemType.olAppointmentItem), _ 
                    Outlook.AppointmentItem) 
 
                ' Loop over all child nodes, check the node name, and import the data into the appointment fields. 
 
                For Each node As XmlNode In appointmentNode.ChildNodes 
                    Select Case (node.Name) 
 
                        Case "starttime" 
                            newAppointment.Start = DateTime.Parse(node.InnerText) 
 
 
                        Case "endtime" 
                            newAppointment.End = DateTime.Parse(node.InnerText) 
 
 
                        Case "subject" 
                            newAppointment.Subject = node.InnerText 
 
 
                        Case "location" 
                            newAppointment.Location = node.InnerText 
 
 
                        Case "body" 
                            newAppointment.Body = node.InnerText 
 
 
                    End Select 
                Next 
 
                ' Save the item in the default calendar. 
                newAppointment.Save() 
                appointments.Add(newAppointment) 
            Next 
 
            ' Return an array of new appointments. 
            Return appointments.ToArray() 
        End Function 
 
 
    End Class 
End Namespace
```

