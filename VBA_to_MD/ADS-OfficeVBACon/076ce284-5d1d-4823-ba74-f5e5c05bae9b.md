

---
ms.Toctitle:Microsoft Office ソリューション開発者向けのセキュリティの注意事項
title:Microsoft Office ソリューション開発者向けのセキュリティの注意事項
ms.ContentId:076ce284-5d1d-4823-ba74-f5e5c05bae9b
---
# Microsoft Office ソリューション開発者向けのセキュリティの注意事項



>[!NOTE]
>Microsoft Visual Basic for Applications (VBA) コードを組み込んだり、COM アドインを実行したりできるのは、マクロが有効な文書、ワークシート、およびプレゼンテーションに限られます。マクロ有効ファイルを作成するには、ドキュメントを保存するときに特別な拡張子を付けます。これらの拡張子は、Microsoft Word では .docm または .dotm、Microsoft Excel では .xlsm、xltm、または xlam、Microsoft PowerPoint では pptm、potm、ppam、または ppsm です。


署名のない COM アドインをインストールして実行するには、セキュリティ センターの **[アドイン]** タブで、**[アプリケーション アドインに対し、信頼できる発行元の署名を必須にする]** オプションと **[すべてのアプリケーション アドインを無効にする]** オプションをオフにする必要があります。**[アドイン]** タブを開くには、**[ファイル]** タブをクリックしてから、**[オプション]**、**[セキュリティ センター]**、**[セキュリティ センターの設定]**、**[アドイン]** の順にクリックします。



デジタル署名されていないものも含めて、すべての VBA マクロを実行するには、セキュリティ センターで **[すべてのマクロを有効にする]** オプションを選択する必要があります。**[マクロの設定]** のオプションを表示するには、**[ファイル]** タブをクリックしてから、**[オプション]**、**[セキュリティ センター]**、**[セキュリティ センターの設定]**、**[マクロの設定]** の順にクリックします。セキュリティ上の理由により、この設定を適用するのはテスト環境だけにすることを強くお勧めします。テスト終了後は元の状態に戻してください。



セキュリティ センターの **[マクロの設定]** タブでは、**[警告を表示せずにすべてのマクロを無効にする]**、**[警告を表示してすべてのマクロを無効にする]**、または **[デジタル署名されたマクロを除き、すべてのマクロを無効にする]** を選択することもできます。Word ドキュメント、Excel ワークシート、PowerPoint プレゼンテーション (.docm、xlsm、pptm) をマクロ無効ファイルとして保存することによっても、マクロを無効にすることができます。また、VBA プロジェクトのオブジェクト モデルにアクセスできるようにするかどうかは、**[マクロの設定]** タブの **[VBA プロジェクト オブジェクト モデルへのアクセスを信頼する]** オプションをオンまたはオフにすることで設定できます。

>[!NOTE]
>Office Fluent リボン ユーザー インターフェイスでは、COM やアプリケーション特有のアドインが有効化されて読み込まれると、それらのコントロールが **[アドイン]** タブに表示されます。





セキュリティ センターの **[アドイン]** タブには、利用できるアドインの一覧が表示されます。同じタブで、COM や Word アドインを有効化、無効化、追加、または削除することができます。それには、**[管理]** ラベルの横にあるドロップダウン ボックスでアドインの種類を選択し、**[設定]** ボタンをクリックします。



## Microsoft Windows レジストリの変更
Microsoft Windows レジストリの変更は、どんな方法で行うにしても (レジストリ エディターを使用しても、プログラムを使用しても)、常にある程度のリスクを伴います。変更が適切でないと、オペレーティング システムの再インストールが必要になるような深刻な問題を引き起こす場合があります。コンピューターのレジストリを変更するときは、常にあらかじめバックアップをとるようにしてください。Microsoft Windows NT、Microsoft Windows 2000、Microsoft Windows XP、または Microsoft Windows Server 2003 を実行している場合は、システム修復ディスク (ERD) も更新してください。



レジストリの編集方法の詳細については、レジストリ エディター (Regedit.exe) の「キーおよび値を変更する」ヘルプ トピック、またはレジストリ エディター (Regedt32.exe) の「レジストリ情報の追加と削除」および「レジストリ情報の編集」トピックを参照してください。



## Microsoft Windows アプリケーション プログラミング インターフェイス (API) 関数呼び出しを行う
Microsoft Windows の関数を呼び出す前に、引数とデータ型を Windows API DLL がどのような方法で処理するかを理解しておく必要があります。Windows 関数の呼び出し方が適切でないと、無効なページ フォールトなどの予期しない動作が引き起こされる可能性があります。Windows 関数の呼び出しの詳細については、Microsoft Office 2000 Developer オンライン ドキュメントまたは MSDN (Microsoft Developer Network) ライブラリの「Windows API とその他のダイナミック リンク ライブラリ」トピックを参照してください。



## デジタル コード署名
ドキュメントにデジタル署名するというのは、ドキュメントに "押印" する処理のことです。この方法により、ドキュメントの受信者は、そのドキュメントの出所を確認することができ、署名後にドキュメントの内容が改変されているかどうかを確認することもできます。デジタル署名を使用すると、ドキュメントに読み取り専用であるとの印を付けて、ドキュメントの真正性と完全性を保証することもできます。



デジタル署名に加え、ドキュメントのコンテンツ内に表示される、ドキュメント内署名を施すこともできます。ドキュメントの発信者は、ドキュメントに署名行を設け、署名しない状態で受信者に送って、署名するように求めることができます。受信者はそのドキュメントを開いて署名行を見つけ、署名を施して発信者に返します。



ドキュメントにデジタル署名する手順を大まかにまとめると、次のようになります。

1. ドキュメントの発信者は、"ハッシュ化" という処理により、ドキュメントの内容を数行に圧縮します。圧縮された内容をメッセージ ダイジェストといいます。ハッシュ化処理は専用のソフトウェアで行います。
2. 次に発信者は、署名機関から取得した秘密キーを使ってメッセージ ダイジェストを暗号化します。これがデジタル署名です。
3. 発信者はこのデジタル署名をドキュメントに添付します。ここまでで、ハッシュ化されたデータ全体に署名が施され、署名が暗号化されて、ドキュメントに添付されたわけです。
4. 発信者はこのドキュメントを受信者に送ります。
5. 受信者はまず、発信者から受け取った公開キーを使ってドキュメントを復号します。これにより、署名はメッセージ ダイジェストの形に戻ります。これがうまくいけば、ドキュメントは確かに発信者が署名したものであることが証明されます。
6. 受信者はデジタル署名ソフトウェアを使って、ドキュメントをハッシュ化してメッセージ ダイジェストを生成し、このハッシュと発信者から受け取ったハッシュを比較します。両者が一致すれば、発信者がドキュメントを送信してから、ドキュメントの内容は改変されていないことになります。




デジタル署名をユーザーが利用できるようになったのは Office XP 以降です。しかし、Office 2007 では機能が追加され、より簡単な操作でドキュメントにデジタル署名し、ドキュメントに署名して読み取り専用にし、ドキュメント内にインライン署名行を追加することができるようになりました。UNRESOLVED_TOKEN_VAL(officenvshort) ユーザーは、これらのタスクを、**[ファイル]** タブにある Office ユーザー インターフェイスから実行できます。



Office 2007 では、インライン署名やデジタル署名をプログラムで操作しやすくするメンバーも導入されました。詳細については、MSDN ライブラリで、「Office 署名」を検索してください。



## Microsoft Office 2013 でのマネージ COM アドインの安全な展開
UNRESOLVED_TOKEN_VAL(officenvshort) セキュリティに準拠するには、マネージ COM アドイン (共通言語ランタイムを目的とする COM アドイン) にデジタル署名し、セキュリティ センターで、Office アプリケーションにアドインを追加できるようにユーザーのセキュリティを設定する必要があります。さらに、マネージ COM アドイン プロジェクトに小規模なアンマネージ プロキシ (*shim* と呼ばれる) を組み込んで、予期しないセキュリティ警告を回避する必要があります。詳細については、MSDN ライブラリで、"deployment managed add-ins" を検索してください。



## Visual Basic Editor の自動化
UNRESOLVED_TOKEN_VAL(officenvshort)では、Microsoft Visual Basic for Applications Extensibility オブジェクト モデルの機能を呼び出すときに、Visual Basic プロジェクトへのプログラム アクセスは信頼されないというエラー メッセージが表示される場合があります。このメッセージが出ないようにするためには、**[ファイル]** タブをクリックし、**[オプション]** をクリックします。そして **[セキュリティ センター]** タブをクリックし、**[セキュリティ センターの設定]** をクリックします。次に **[マクロの設定]** タブをクリックし、**[VBA プロジェクト オブジェクト モデルへのアクセスを信頼する]** ボックスをオンにします。このボックスをオンにすると、マクロが有効なドキュメントを開いたときに、その中のマクロが Microsoft Visual Basic のコア オブジェクト、メソッド、およびプロパティにアクセスできるようになります。このことは、セキュリティが危険にさらされる可能性があることも意味します。**[VBA プロジェクト オブジェクト モデルへのアクセスを信頼する]** ボックスをオンにするのは、Visual Basic オブジェクト モデルにアクセスするマクロの実行期間中だけにすることをお勧めします。そのマクロが終了したら、**[VBA プロジェクト オブジェクト モデルへのアクセスを信頼する]** ボックスをオフにしてください。



## パスワード
アプリケーションにハードコードされたパスワードを使わないでください。プロシージャでパスワードが必要な場合は、ユーザーに要求したパスワードを変数に格納し、プログラムでその変数を使います。



強力なパスワードを必ず使います。強力なパスワードには以下が含まれます。

- 大文字と小文字の両方。
- 数字。
- 記号 (#、$、%、^ など)。
- 8 文字以上にします。




強力なパスワードには、パターン、テーマ、辞書に掲載されている単語などを含めないでください。



例

- $tR0n9p@$s
- G80dn[s$M4!


>[!NOTE]
>パスワードは頻繁に (たとえば、1 ～ 3 か月ごとに) 変更してください。






